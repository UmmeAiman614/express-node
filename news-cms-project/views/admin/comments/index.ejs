<div id="admin-content">
      <div class="container">
          <div class="row">
              <div class="col-md-12">
                  <h1 class="admin-heading"><i class="fa fa-comments"></i> Comments Management</h1>
              </div>
              <div class="col-md-12">
                  <div id="commentsTable"></div>
              </div>
          </div>
      </div>
  </div>


  <div class="modal" id="commentModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="commentModalLabel">Modal title</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="commentModalBody">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/tabulator-tables@6.0.0/dist/js/tabulator.min.js"></script>

<script>
  const tableData = <%- JSON.stringify(comments) %>;

  const table = new Tabulator("#commentsTable", {
    data: tableData,
    layout: "fitColumns",
    pagination: true,
    paginationSize: 10,
    paginationSizeSelector: [5, 10, 25, 50, 100],
    columns: [
      { title: "S.No.", formatter: "rownum", width: 100, hozAlign: 'center' },
      { title: "Article", field: "article.title", headerFilter: 'input' },
      { title: "Content", field: "content", headerFilter: 'input' },
      { title: "Name", field: "name", headerFilter: 'input' },
      { title: "Date", field: "createdAt", headerFilter: 'input', formatter: function (cell, ) { return new Date(cell.getValue()).toDateString() } },
      { title: "Status", field: "status", headerFilter: 'input' },
      {
        title: "Actions", formatter: function (cell) {
          return `
            <button onclick = "viewComment(${cell.getData()._id})" class="btn btn-sm btn-success">View</button>
            <button onclick='deleteComment('${cell.getData()._id})' class="btn btn-sm btn-danger delete-comment">Delete</button>
          `;
        }
      },
    ],
  });

  //view comment
  async function viewComment(id) {
    const comment = tableData.find(comment => comment._id === id);

    if (!comment) {
        console.error(`Comment with ID ${id} not found`);
        return;
    }

    const html = `<p><b>Message : </b>${comment.content}</p>`;

    document.getElementById('commentModalLabel').textContent = `Comment By : ${comment.name}`;
    document.getElementById('commentModalBody').innerHTML = html;

    const modal = new bootstrap.Modal(document.getElementById('commentModal'));
    modal.show();
}

  async function deleteComment(id) {
    try {
      if (confirm("Are you sure to delete this Comment?")) {
        const response = await fetch(`/admin/delete-article/${id}`, { method: "DELETE" });
        if (response.ok) {
          window.location.reload();
        } else {
          alert("Failed to delete category.");
        }
        
      }
    } catch (error) {
      console.error("Delete error:", error);
    }
  }
</script>



<%- contentFor('tabulatorCSS') %>
<link href="https://unpkg.com/tabulator-tables@6.0.0/dist/css/tabulator.min.css" rel="stylesheet">